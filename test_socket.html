<!DOCTYPE html>
<html>
<head>
    <title>Socket.IO Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #status { padding: 10px; border-radius: 5px; margin: 10px 0; }
        .connected { background: #d4edda; color: #155724; }
        .disconnected { background: #f8d7da; color: #721c24; }
        .connecting { background: #fff3cd; color: #856404; }
        .message { margin: 5px 0; padding: 8px; border-left: 3px solid #007bff; }
    </style>
</head>
<body>
    <h2>Socket.IO –¢–µ—Å—Ç –∫–ª–∏–µ–Ω—Ç</h2>
    
    <div id="status" class="connecting">üîÑ –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è...</div>
    
    <div>
        <button onclick="sendTest()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
        <button onclick="disconnect()">–û—Ç–∫–ª—é—á–∏—Ç—å—Å—è</button>
        <button onclick="connect()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
    </div>
    
    <div id="messages" style="margin-top: 20px;"></div>
    
    <script src="https://cdn.socket.io/4.8.0/socket.io.min.js"></script>

    <script>
        let socket = null;
        const status = document.getElementById('status');
        const messages = document.getElementById('messages');
        
        function connect() {
            if (socket?.connected) {
                addMessage('‚ö†Ô∏è –£–∂–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ');
                return;
            }
            
            status.className = 'connecting';
            status.innerHTML = 'üîÑ –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è...';
            
        socket = io("http://localhost:5200", {
            transports: ["websocket", "polling"],
            path: "/socket.io/",
            reconnectionAttempts: 5,
            reconnectionDelay: 1000,
            timeout: 10000,
            pingInterval: 25000,   // ‚ö°Ô∏è –≤–∞–∂–Ω–æ
            pingTimeout: 60000     // ‚ö°Ô∏è –≤–∞–∂–Ω–æ
        });

            
            socket.on('connect', () => {
                status.className = 'connected';
                status.innerHTML = '‚úÖ –£—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ! ID: ' + socket.id;
                addMessage('–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É');
            });
            
            socket.on('connected', (data) => {
                addMessage('üîî –°–µ—Ä–≤–µ—Ä: ' + data.message + ' (ID: ' + data.id + ')');
            });
            
            socket.on('test_reply', (data) => {
                addMessage('üß™ –û—Ç–≤–µ—Ç –Ω–∞ —Ç–µ—Å—Ç: ' + data);
            });
            
            socket.on('message_reply', (data) => {
                addMessage('üì® –û—Ç–≤–µ—Ç: ' + data);
            });
            
            socket.on('new-message', (data) => {
                addMessage('üì¢ –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: ' + JSON.stringify(data));
            });
            
            socket.on('ping', (data) => {
                addMessage('üèì Ping –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
                socket.emit('pong', 'pong from client');
            });
            
            socket.on('pong', (data) => {
                addMessage('üèì Pong –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
            });
            
            socket.on('disconnect', (reason) => {
                status.className = 'disconnected';
                status.innerHTML = '‚ùå –û—Ç–∫–ª—é—á–µ–Ω–æ: ' + reason;
                addMessage('–û—Ç–∫–ª—é—á–µ–Ω–æ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞: ' + reason);
            });
            
            socket.on('connect_error', (error) => {
                status.className = 'disconnected';
                status.innerHTML = 'üí• –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è';
                addMessage('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message, 'red');
            });
            
            socket.on('reconnect_attempt', (attempt) => {
                addMessage('üîÑ –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + attempt);
            });
            
            socket.on('reconnect_failed', () => {
                addMessage('üí• –ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è', 'red');
            });
        }
        
        function disconnect() {
            if (socket) {
                socket.disconnect();
                addMessage('–û—Ç–∫–ª—é—á–µ–Ω–æ –≤—Ä—É—á–Ω—É—é');
            }
        }
        
        function sendTest() {
            if (!socket?.connected) {
                addMessage('‚ö†Ô∏è –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'red');
                return;
            }
            
            const text = prompt('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:', '–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ');
            if (text) {
                socket.emit('message', text);
                addMessage('üì§ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: ' + text);
            }
        }
        
        function addMessage(text, color = 'black') {
            const message = document.createElement('div');
            message.className = 'message';
            message.style.color = color;
            message.textContent = new Date().toLocaleTimeString() + ' - ' + text;
            messages.appendChild(message);
            messages.scrollTop = messages.scrollHeight;
        }
        
        // –ê–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        connect();
    </script>
</body>
</html>